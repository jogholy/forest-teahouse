# 🍵 森林茶屋 - 项目开发计划

## 一、技术选型

### 1.1 前端技术栈

**游戏引擎选择：Cocos Creator 3.x**

理由：
- ✅ 2D游戏开发成熟，适合手绘风格
- ✅ 支持TypeScript，便于TDD
- ✅ 跨平台（iOS/Android/Web）
- ✅ Spine动画集成良好
- ✅ 国内社区活跃，文档完善

**核心技术：**
- **语言**：TypeScript 5.x
- **UI框架**：Cocos Creator UI系统
- **动画**：Spine 2D骨骼动画
- **状态管理**：自研轻量状态机（基于观察者模式）
- **数据持久化**：LocalStorage + IndexedDB（离线优先）

### 1.2 后端技术栈

**架构选择：Serverless + BaaS（Backend as a Service）**

理由：
- ✅ 降低初期运维成本
- ✅ 弹性扩展
- ✅ 专注业务逻辑

**技术方案：**
- **云服务**：Firebase / Supabase（开源替代）
- **实时数据库**：Firestore / Supabase Realtime
- **认证**：Firebase Auth / Supabase Auth
- **云函数**：Cloud Functions（处理复杂业务逻辑）
- **CDN**：Cloudflare（静态资源加速）

**备选方案（自建后端）：**
- **框架**：Node.js + Fastify
- **数据库**：PostgreSQL + Redis
- **部署**：Docker + K8s

### 1.3 开发工具链

**版本控制：**
- Git + GitHub
- 分支策略：Git Flow（main/develop/feature/hotfix）

**测试框架：**
- **单元测试**：Jest + ts-jest
- **集成测试**：Cocos Test（自带）
- **E2E测试**：Playwright（Web版本）
- **覆盖率目标**：核心逻辑 >80%

**CI/CD：**
- GitHub Actions
- 自动化测试 + 构建 + 部署

**项目管理：**
- **看板**：GitHub Projects / Jira
- **文档**：Notion / Confluence
- **设计协作**：Figma

---

## 二、敏捷开发框架

### 2.1 迭代周期

**Sprint时长**：2周/迭代
**发布节奏**：
- Alpha版本：每4周（2个Sprint）
- Beta版本：每2周
- 正式版本：根据里程碑

### 2.2 团队角色（假设小团队配置）

| 角色 | 职责 | 人数 |
|-----|------|-----|
| Product Owner | 需求优先级、验收标准 | 1 |
| Scrum Master | 流程推进、障碍清除 | 1（可兼任） |
| 前端开发 | 游戏逻辑、UI实现 | 2-3 |
| 美术设计 | 场景、角色、UI美术 | 2 |
| 后端开发 | 服务端逻辑、数据库 | 1（Serverless可减少） |
| QA测试 | 测试用例、Bug跟踪 | 1 |

### 2.3 敏捷仪式

**每日站会（Daily Standup）**
- 时间：每天早上10:00，15分钟
- 内容：昨天完成/今天计划/遇到障碍

**Sprint计划会（Sprint Planning）**
- 时间：每个Sprint第一天，2小时
- 产出：Sprint Backlog + 任务拆解

**Sprint评审会（Sprint Review）**
- 时间：每个Sprint最后一天，1小时
- 产出：可演示版本 + 反馈收集

**Sprint回顾会（Sprint Retrospective）**
- 时间：Sprint评审后，1小时
- 产出：改进措施

---

## 三、TDD开发流程

### 3.1 TDD三步骤

```
Red（写失败测试） → Green（最小实现） → Refactor（重构优化）
```

### 3.2 测试分层策略

**L1 - 单元测试（Unit Tests）**
- 覆盖范围：核心业务逻辑、数据模型、工具函数
- 测试框架：Jest
- 示例：
  ```typescript
  // 测试食材稀有度计算
  describe('IngredientGacha', () => {
    it('should return Rare ingredient with 8% probability', () => {
      const gacha = new IngredientGacha();
      const results = Array(1000).fill(0).map(() => gacha.roll());
      const rareCount = results.filter(r => r.rarity === 'Rare').length;
      expect(rareCount).toBeGreaterThan(60); // 8% ± 2%
      expect(rareCount).toBeLessThan(100);
    });
  });
  ```

**L2 - 集成测试（Integration Tests）**
- 覆盖范围：模块间交互、数据流
- 示例：采集系统 → 背包系统 → 配方系统

**L3 - E2E测试（End-to-End Tests）**
- 覆盖范围：关键用户流程
- 示例：新手引导 → 采集食材 → 泡茶 → 接待客人

### 3.3 测试覆盖率目标

| 模块 | 单元测试 | 集成测试 | E2E测试 |
|-----|---------|---------|---------|
| 核心玩法（采集/配方/客人） | >80% | >60% | 100%关键路径 |
| UI交互 | >50% | >40% | 主流程覆盖 |
| 数据持久化 | >90% | >70% | - |
| 社交系统 | >70% | >50% | 异步场景 |

### 3.4 TDD实践规范

**开发流程：**
1. **需求拆解** → 编写验收标准（Given-When-Then）
2. **编写测试** → 先写测试用例（Red）
3. **最小实现** → 让测试通过（Green）
4. **重构优化** → 保持测试通过（Refactor）
5. **代码审查** → PR必须包含测试

**示例：食谱解锁功能**

```typescript
// Step 1: 验收标准
// Given: 玩家满足客人"棉棉"3次
// When: 第3次服务完成
// Then: 解锁"清新绿茶"食谱

// Step 2: 编写测试（Red）
describe('RecipeUnlock', () => {
  it('should unlock recipe after serving guest 3 times', () => {
    const player = new Player();
    const guest = new Guest('棉棉');
    
    player.serveGuest(guest); // 第1次
    player.serveGuest(guest); // 第2次
    expect(player.hasRecipe('清新绿茶')).toBe(false);
    
    player.serveGuest(guest); // 第3次
    expect(player.hasRecipe('清新绿茶')).toBe(true);
  });
});

// Step 3: 最小实现（Green）
class Player {
  private serveCount = new Map<string, number>();
  private recipes = new Set<string>();
  
  serveGuest(guest: Guest) {
    const count = (this.serveCount.get(guest.name) || 0) + 1;
    this.serveCount.set(guest.name, count);
    
    if (count === 3 && guest.name === '棉棉') {
      this.recipes.add('清新绿茶');
    }
  }
  
  hasRecipe(name: string): boolean {
    return this.recipes.has(name);
  }
}

// Step 4: 重构（Refactor）
// 提取配置、优化逻辑...
```

---

## 四、分阶段版本开发计划

### 4.1 版本规划总览

```
MVP (v0.1) → Alpha (v0.5) → Beta (v0.9) → Release (v1.0) → 迭代更新
  ↓            ↓              ↓              ↓              ↓
 核心验证    完整闭环       打磨体验       上线运营      内容扩展
```

---

### 📦 Phase 0: 项目启动（Pre-Sprint）

**时长**：1周
**目标**：搭建基础设施，建立开发规范

**交付物：**
- [x] 技术选型文档
- [ ] 项目脚手架（Cocos Creator项目 + Git仓库）
- [ ] CI/CD流水线（GitHub Actions）
- [ ] 测试框架配置（Jest + 测试模板）
- [ ] 代码规范（ESLint + Prettier + Git Hooks）
- [ ] 美术资产管理规范（命名、目录结构）

**验收标准：**
- 开发环境一键启动
- 提交代码自动跑测试
- 美术资产导入流程文档化

---

### 🎯 Phase 1: MVP版本（v0.1）

**时长**：4周（2个Sprint）
**目标**：验证核心玩法，最小可玩版本

#### Sprint 1（Week 1-2）：核心循环 - 采集与配方

**User Stories：**

1. **作为玩家，我想采集食材**
   - 验收标准：
     - Given: 进入森林庭院场景
     - When: 点击发光植物
     - Then: 获得随机食材，显示稀有度
   - 任务拆解：
     - [ ] 食材数据模型（Ingredient类）
     - [ ] Gacha抽卡系统（概率计算 + 保底）
     - [ ] 采集UI（点击交互 + 动画）
     - [ ] 背包系统（存储 + 显示）
   - 测试用例：
     - 稀有度概率分布测试
     - 保底机制测试
     - 背包容量测试

2. **作为玩家，我想尝试配方**
   - 验收标准：
     - Given: 拥有2种以上食材
     - When: 在试茶台组合食材
     - Then: 显示成功/失败结果
   - 任务拆解：
     - [ ] 配方数据结构（Recipe类）
     - [ ] 配方匹配算法
     - [ ] 试茶台UI（拖拽交互）
     - [ ] 成功/失败反馈动画
   - 测试用例：
     - 配方匹配正确性测试
     - 无配方时30%成功率测试
     - 食材消耗逻辑测试

**技术债务：**
- 暂时硬编码5个基础食材
- 暂时只实现1个配方
- UI使用占位符美术

**Sprint 1 Demo：**
- 可采集食材 → 可尝试配方 → 可看到结果

---

#### Sprint 2（Week 3-4）：核心循环 - 客人与故事

**User Stories：**

3. **作为玩家，我想接待客人**
   - 验收标准：
     - Given: 拥有已解锁的茶饮
     - When: 客人到访并点单
     - Then: 泡茶并获得反馈
   - 任务拆解：
     - [ ] 客人数据模型（Guest类）
     - [ ] 客人出现逻辑（随机 + 条件触发）
     - [ ] 泡茶流程动画（5步骤）
     - [ ] 客人反应系统（满意度计算）
   - 测试用例：
     - 客人偏好匹配测试
     - 满意度计算测试
     - 小费奖励测试

4. **作为玩家，我想收集故事**
   - 验收标准：
     - Given: 完美服务客人（3星）
     - When: 服务结束
     - Then: 解锁1个故事片段
   - 任务拆解：
     - [ ] 故事数据结构（Story类）
     - [ ] 故事解锁逻辑
     - [ ] 故事展示UI（对话框）
     - [ ] 故事收集进度追踪
   - 测试用例：
     - 故事解锁条件测试
     - 故事去重测试
     - 进度持久化测试

**技术债务：**
- 暂时只实现2个客人（棉棉、咕咕）
- 每个客人只有1个故事片段
- 泡茶动画使用简化版

**Sprint 2 Demo：**
- 完整核心循环：采集 → 配方 → 接待 → 故事

**MVP里程碑验收：**
- ✅ 10-15分钟完整游戏循环可玩
- ✅ 核心系统单元测试覆盖率 >70%
- ✅ 可演示给测试玩家

---

### 🚀 Phase 2: Alpha版本（v0.5）

**时长**：8周（4个Sprint）
**目标**：完整功能闭环，内容填充

#### Sprint 3-4（Week 5-8）：系统完善

**功能清单：**

5. **茶屋升级系统**
   - Lv.1 → Lv.3 升级路线
   - 座位数量扩展
   - 装饰系统基础框架

6. **食谱精通系统**
   - 1-3星评价机制
   - 精通度累积
   - 解锁"精致摆盘"

7. **四季系统（简化版）**
   - 春/夏两个季节
   - 季节影响食材爆率
   - 季节限定客人

8. **数据持久化**
   - 云存档（Firebase/Supabase）
   - 离线数据同步
   - 数据迁移机制

**测试重点：**
- 存档系统压力测试
- 跨设备同步测试
- 数据一致性测试

---

#### Sprint 5-6（Week 9-12）：内容扩充

**内容目标：**
- 食材：20种（覆盖4个稀有度）
- 配方：15个（基础10 + 隐藏5）
- 客人：5个（初始2 + 解锁3）
- 故事：每个客人3-5个片段

**美术资产：**
- 场景背景：茶屋室内（春夏版本）
- 角色立绘：5个客人 × 3姿态
- UI元素：完整一套手绘风格
- 动画：泡茶流程完整版

**测试重点：**
- 内容平衡性测试（爆率、难度曲线）
- 性能测试（资源加载、内存占用）

**Alpha里程碑验收：**
- ✅ 完整功能闭环（采集/配方/客人/升级/四季）
- ✅ 2小时以上游戏内容
- ✅ 核心美术资产到位
- ✅ 小范围封闭测试（20-50人）

---

### 🎨 Phase 3: Beta版本（v0.9）

**时长**：6周（3个Sprint）
**目标**：打磨体验，社交系统，压力测试

#### Sprint 7-8（Week 13-16）：社交与优化

**功能清单：**

9. **异步社交系统**
   - 茶会邀请卡
   - 茶评系统
   - 食材互赠

10. **双人茶会模式**
    - 实时匹配
    - 默契度计算
    - 羁绊茶叶奖励

11. **UI/UX优化**
    - 新手引导流程
    - 操作反馈优化
    - 加载优化

**测试重点：**
- 社交功能集成测试
- 网络异常处理测试
- 用户体验测试（A/B测试）

---

#### Sprint 9（Week 17-18）：压力测试与修复

**任务清单：**
- [ ] 性能优化（帧率稳定60fps）
- [ ] 内存优化（峰值 <200MB）
- [ ] 网络优化（弱网环境测试）
- [ ] Bug修复（P0/P1级别清零）
- [ ] 数据埋点（关键指标监控）

**测试重点：**
- 压力测试（1000+并发用户）
- 兼容性测试（主流设备覆盖）
- 安全测试（数据加密、防作弊）

**Beta里程碑验收：**
- ✅ 所有核心功能稳定
- ✅ 社交系统可用
- ✅ 性能达标
- ✅ 公开测试（500-1000人）

---

### 🎉 Phase 4: Release版本（v1.0）

**时长**：4周（2个Sprint）
**目标**：上线准备，运营支持

#### Sprint 10-11（Week 19-22）：上线冲刺

**任务清单：**

12. **内容完整性**
    - 食材：40种
    - 配方：30个
    - 客人：8-10个
    - 四季完整（春夏秋冬）

13. **付费系统**
    - 季度通行证
    - 装饰商店
    - 传说食材礼包
    - 支付集成（IAP）

14. **运营工具**
    - 后台管理系统
    - 数据看板
    - 活动配置系统
    - 客服系统

15. **合规与发布**
    - 隐私政策
    - 用户协议
    - 应用商店资料
    - 审核提交

**测试重点：**
- 支付流程测试
- 数据安全审计
- 合规性检查

**Release里程碑验收：**
- ✅ 通过应用商店审核
- ✅ 运营工具就绪
- ✅ 客服流程建立
- ✅ 正式上线

---

### 🔄 Phase 5: 迭代更新（v1.x）

**节奏**：每月1个大版本 + 每周1次热更新

**内容规划：**

**v1.1（上线后1个月）**
- 新客人：2个
- 新配方：10个
- 新装饰：1套主题包
- 首个季节活动："森林茶会祭"

**v1.2（上线后2个月）**
- 新区域：森林深处（探索玩法）
- 新系统：茶具收集
- 社交增强：公会/茶社系统

**v1.3（上线后3个月）**
- 新玩法：茶艺大赛（PvE排行榜）
- 新客人：3个
- 新季节：特殊节日（中秋/圣诞）

**长期规划：**
- 年度大版本（v2.0）：新地图、新玩法
- 持续运营：每周活动、每月更新

---

## 五、风险管理

### 5.1 技术风险

| 风险 | 影响 | 概率 | 应对措施 |
|-----|------|------|---------|
| Cocos Creator性能问题 | 高 | 中 | 提前做性能基准测试，准备降级方案 |
| Serverless冷启动延迟 | 中 | 高 | 关键接口预热，考虑混合架构 |
| 跨平台兼容性问题 | 高 | 中 | 每个Sprint做设备测试 |
| 数据同步冲突 | 中 | 中 | 设计冲突解决策略，版本号机制 |

### 5.2 项目风险

| 风险 | 影响 | 概率 | 应对措施 |
|-----|------|------|---------|
| 美术资产延期 | 高 | 中 | 使用占位符，美术并行开发 |
| 需求频繁变更 | 中 | 高 | 严格控制Sprint范围，变更走流程 |
| 测试覆盖不足 | 高 | 中 | TDD强制执行，代码审查卡点 |
| 团队成员离职 | 高 | 低 | 文档化，知识分享会 |

### 5.3 市场风险

| 风险 | 影响 | 概率 | 应对措施 |
|-----|------|------|---------|
| 竞品抢先上线 | 中 | 中 | 强化差异化特色（茶文化+治愈风） |
| 用户留存率低 | 高 | 中 | 数据驱动迭代，快速响应反馈 |
| 变现困难 | 高 | 中 | 多元化付费点，避免Pay-to-Win |

---

## 六、成功指标（KPI）

### 6.1 开发阶段指标

**代码质量：**
- 单元测试覆盖率 >80%
- 代码审查通过率 100%
- P0 Bug数量 = 0（发布前）

**开发效率：**
- Sprint完成率 >85%
- 需求变更率 <15%
- 技术债务控制在可接受范围

### 6.2 产品指标

**用户留存：**
- 次日留存 >40%
- 7日留存 >20%
- 30日留存 >10%

**用户参与：**
- 日均游戏时长 >15分钟
- 每周活跃天数 >3天
- 社交功能使用率 >30%

**商业化：**
- 付费率 >3%
- ARPU >$0.5
- LTV/CAC >3

---

## 七、总结

### 7.1 关键里程碑时间线

```
Week 0:    项目启动
Week 1-4:  MVP (v0.1) - 核心验证
Week 5-12: Alpha (v0.5) - 完整闭环
Week 13-18: Beta (v0.9) - 打磨体验
Week 19-22: Release (v1.0) - 正式上线
Week 23+:  迭代更新 (v1.x) - 持续运营
```

**总时长**：约6个月（从启动到上线）

### 7.2 团队协作原则

1. **透明沟通**：所有信息公开透明，问题及时暴露
2. **快速迭代**：小步快跑，频繁交付
3. **质量优先**：TDD不妥协，技术债务及时还
4. **用户导向**：数据驱动决策，快速响应反馈
5. **持续改进**：每个Sprint回顾，不断优化流程

### 7.3 下一步行动

**立即执行：**
1. [ ] 组建核心团队
2. [ ] 搭建开发环境
3. [ ] 创建GitHub仓库
4. [ ] 编写第一个测试用例
5. [ ] 开始Sprint 1

**本周目标：**
- 完成Phase 0所有交付物
- 召开Sprint 1计划会
- 开始第一个User Story开发

---

**让我们开始吧！🚀**
